alias NimbleCSV.RFC4180, as: CSV

csv = """
amamoto-hideyo,"[{""name"": ""Amamoto Eisei"", ""context"": null, ""category"": ""mistranslation"", ""japanese_name"": ""天本英世""}]"
arishima-ichiro,"[{""name"": ""Ôshima Tadao"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""大島忠雄""}]"
asahiyo-taro,"[{""name"": ""Yonekawa Fumitoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""米川文敏""}]"
chiaki-minoru,"[{""name"": ""Sasaki Katsuji"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""佐々木勝治""}]"
dunham-robert,"[{""name"": ""Dan Yuma"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""ダン・ユマ""}]"
echigo-ken,"[{""name"": ""Echigo Kenzô"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""越後憲三""}]"
fujiki-yu,"[{""name"": ""Suzuki Yûzô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""鈴木悠蔵""}]"
funato-jun,"[{""name"": ""Nishina Tsunetaka"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""仁科常隆""}]"
hara-setsuko,"[{""name"": ""Aida Masae"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""会田昌江""}]"
hidari-bokuzen,"[{""name"": ""Mikashima Ichiro"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""三ヶ島一郎""}]"
hirata-akihiko,"[{""name"": ""Onoda Akihiko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""小野田昭彦""}]"
inagaki-hiroshi,"[{""name"": ""Kahijara Kinpachi"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""梶原金八""}, {""name"": ""Azuma Akihiro"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""東明浩""}, {""name"": ""Inagaki Kôjirô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""稲垣浩二郎""}]"
ito-emi,"[{""name"": ""Itô Hideyo"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""伊藤日出代""}]"
ito-hisaya,"[{""name"": ""Itô Naoya"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""伊藤尚也""}]"
ito-jerry,"[{""name"": ""Gerald Takemichi Itô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": null}]"
ito-yumi,"[{""name"": ""Itô Tsukiko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""伊藤月子""}]"
jojo-anri,"[{""name"": ""Jôjô Anri"", ""category"": ""alias"", ""japanese_name"": ""上條安里""}]"
kagawa-kyoko,"[{""name"": ""Makino Kyôko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""牧野香子""}]"
kato-daisuke,"[{""name"": ""Katô Tokunosuke"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""加藤徳之助""}]"
kawazu-seizaburo,"[{""name"": ""Nakajima Seiichi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""中島誠一""}]"
kayama-shigeru,"[{""name"": ""Yamada Kôji"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山田鉀治""}]"
kimura-takeshi,"[{""name"": ""Mabuchi Kaoru"", ""context"": ""After 1964"", ""category"": ""alias"", ""japanese_name"": ""馬淵薫""}]"
kodo-kuninori,"[{""name"": ""Tanikawa Saichirô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""谷川佐市郎""}]"
kouchi-momoko,"[{""name"": ""Ôkouchi Momoko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""大河内桃子""}]"
kubo-akira,"[{""name"": ""Yamauchi Yasuyoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山内康儀""}]"
kumagai-takuzo,"[{""name"": ""Kumagai Jirô"", ""context"": ""Before 1964"", ""category"": ""alias"", ""japanese_name"": ""熊谷二良""}]"
kurobe-susumu,"[{""name"": ""Yoshimoto Takashi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""吉本隆志""}]"
little-man-machan,"[{""name"": ""Fukasawa Masao"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""深沢政雄""}]"
matsumoto-somesho,"[{""name"": ""Nomura Hachirô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""野村八郎""}]"
miki-norihei,"[{""name"": ""Tanuma Tadashi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""田沼則子""}]"
mishima-ko,"[{""name"": ""Hase Katsuhiro"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""長谷勝博""}]"
miyauchi-kunio,"[{""name"": ""Miyauchi Kokurô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""宮内国郎""}]"
mizuno-kumi,"[{""name"": ""Igarashi Maya"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""五十嵐麻耶""}]"
morishige-hisaya,"[{""name"": ""Morishige Hisaya"", ""category"": ""alias"", ""japanese_name"": ""森繁久弥""}]"
murakami-fuyuki,"[{""name"": ""Murakami Saishû"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""村上済州""}]"
mutsumi-goro,"[{""name"": ""Nakanishi Seiji"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""中西清二""}]"
nakamura-ganjiro,"[{""name"": ""Hayashi Yoshio"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""林好雄""}]"
nakamura-tetsu,"[{""name"": ""Nakamura Satoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""中村哲""}]"
natsuki-yosuke,"[{""name"": ""Akuzawa Tamotsu"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""阿久沢有""}]"
nomura-kozo,"[{""name"": ""Nomura Akiji"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""野村明司""}, {""name"": ""Osao Kazuhiro"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""尾棹一浩""}]"
okawa-henry,"[{""name"": ""Ôkawa Heihachirô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""大川平八郎""}]"
oshikawa-shunro,"[{""name"": ""Oshikawa Masanori"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""押川方存""}]"
otowa-nobuko,"[{""name"": ""Kaji Nobuko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""加治信子""}]"
sahara-kenji,"[{""name"": ""Katô Masayoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""加藤正好""}]"
sakai-frankie,"[{""name"": ""Sakai Masatoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""堺正俊""}]"
sakai-sachio,"[{""name"": ""Abe Yukio"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""阿部幸男""}]"
sawamura-ikio,"[{""name"": ""Okabe Shizuo"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""岡部静雄""}]"
senda-koreya,"[{""name"": ""Itô Kunio"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""伊藤圀夫""}]"
sera-akira,"[{""name"": ""Watanabe Akira"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""渡辺章""}]"
shimozawa-kan,"[{""name"": ""Umetani Matsutarô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""梅谷松太郎""}]"
shimura-takashi,"[{""name"": ""Shimazaki Shôji"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""島崎捷爾""}]"
shirakawa-yumi,"[{""name"": ""Yamazaki Akiko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山崎安基子""}]"
sonoda-ayumi,"[{""name"": ""Iwadate Yûko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""岩立優子""}]"
sugimura-haruko,"[{""name"": ""Nakano Haruko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""中野春子""}]"
tabu-kenzo,"[{""name"": ""Tabu Yasutarô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""田武安太郎""}]"
tachikawa-hiroshi,"[{""name"": ""Tachikawa Yôichi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""太刀川洋一""}]"
takada-minoru,"[{""name"": ""Takada Noboru"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""高田昇""}]"
tamblyn-russ,"[{""name"": ""Russell Irving Tamblyn"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": null}]"
tazaki-jun,"[{""name"": ""Tanaka Minoru"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""田中実""}]"
tsuburaya-eiji,"[{""name"": ""Tsuburaya Eiichi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""円谷英一""}, {""name"": ""Tsumuraya Eiji"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""圓谷英二""}]"
tsuchiya-shiro,"[{""name"": ""Tsuchiya Hirotoshi"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""土屋博敏""}]"
tsukasa-yoko,"[{""name"": ""Shôji Yôko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""庄司葉子""}]"
tsuruta-koji,"[{""name"": ""Ono Eiichi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""小野榮一""}]"
ueda-kichijiro,"[{""name"": ""Ueda Sadao"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""上田定雄""}]"
uehara-ken,"[{""name"": ""Ikehata Kiyoaki"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""池端清亮""}]"
uehara-misa,"[{""name"": ""Uehara Misako"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""上原美佐子""}]"
wakayama-setsuko,"[{""name"": ""Sakazume Setesuko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""坂爪セツ子""}]"
yachigusa-kaoru,"[{""name"": ""Matsuda Hitomi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""松田瞳""}]"
yamamoto-ren,"[{""name"": ""Yamamoto Kiyoshi"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山本廉""}]"
yamamura-so,"[{""name"": ""Koga Hirosada"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""古賀寛定""}, {""name"": ""Yamamura Sô"", ""context"": null, ""category"": ""alias"", ""japanese_name"": ""山村聡""}]"
yanagiya-kingoro,"[{""name"": ""Yamashita Keitarô"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山下敬太郎""}]"
yashiro-miki,"[{""name"": ""Yamada Mikiko"", ""context"": null, ""category"": ""birth_name"", ""japanese_name"": ""山田美紀子""}]"
yusuf-osman,"[{""name"": ""Johnny Yusef"", ""context"": null, ""category"": ""alias"", ""japanese_name"": \""""}]"
"""

csv
|> CSV.parse_string(skip_headers: false)
|> Enum.flat_map(fn [slug, aliases] ->
  person = Cineaste.Library.get_person_by_slug!(slug)
  decoded_aliases = Jason.decode!(aliases)

  Enum.map(decoded_aliases, fn alias ->
    %{
      alias: Map.get(alias, "name"),
      context: Map.get(alias, "context"),
      category: Map.get(alias, "category"),
      japanese_name: Map.get(alias, "japanese_name"),
      person_id: person.id
    }
  end)
end)
|> Ash.bulk_create!(Cineaste.Library.PersonAlias, :create, return_errors?: true)
